<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to Table Parser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-8">
<div class="max-w-6xl mx-auto">
    <!-- Input View -->
    <div id="inputView" class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
        <h1 class="text-2xl font-semibold text-slate-900 mb-4">Result visualizer</h1>
        <p class="text-sm text-slate-600 mb-4">Paste your JSON result below:</p>

        <textarea
                id="jsonInput"
                class="w-full h-64 p-4 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900 focus:border-transparent font-mono text-sm resize-none"
                placeholder='{
    "eventType": "assessmentCompleted",
    "assessmentId": "834e0f2f-985a-4089-a91f-741d1dfd0d78",
    "occurredAt": "2026-01-07T08:15:32.6892685+00:00"
}'
        ></textarea>

        <div id="errorMessage" class="mt-2 text-sm text-red-600 hidden"></div>

        <button
                id="showResultBtn"
                class="mt-4 px-6 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 transition-colors"
        >
            Show Result
        </button>
        <button
                id="showSampleResultBtn"
                class="mt-4 px-6 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 transition-colors"
        >
            Show example result
        </button>
    </div>

    <!-- Result View -->
    <div id="resultView" class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 hidden">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-semibold text-slate-900">Result</h1>
            <button
                    id="clearBtn"
                    class="px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 transition-colors"
            >
                Clear
            </button>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full border-collapse">
                <thead>
                <tr class="border-b border-slate-200">
                    <th class="text-left p-3 font-semibold text-slate-900 bg-slate-50">Key</th>
                    <th class="text-left p-3 font-semibold text-slate-900 bg-slate-50">Value</th>
                </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const inputView = document.getElementById('inputView');
    const resultView = document.getElementById('resultView');
    const jsonInput = document.getElementById('jsonInput');
    const showResultBtn = document.getElementById('showResultBtn');
    const showSampleResultBtn = document.getElementById('showSampleResultBtn');
    const clearBtn = document.getElementById('clearBtn');
    const tableBody = document.getElementById('tableBody');
    const errorMessage = document.getElementById('errorMessage');

    showSampleResultBtn.addEventListener('click', async () => {

        try {
            const response = await fetch('./resultSample.json');

            const jsonObj = await response.json();
            hideError();
            displayTable(jsonObj);
            inputView.classList.add('hidden');
            resultView.classList.remove('hidden');
        } catch (e) {
            showError('Invalid JSON format: ' + e.message);
        }
    });

    showResultBtn.addEventListener('click', () => {
        const jsonText = jsonInput.value.trim();


        if (!jsonText) {
            showError('Please enter some JSON data');
            return;
        }

        try {
            const jsonObj = JSON.parse(jsonText);

            if (typeof jsonObj !== 'object' || jsonObj === null) {
                showError('Please enter a valid JSON object');
                return;
            }

            hideError();
            displayTable(jsonObj);
            inputView.classList.add('hidden');
            resultView.classList.remove('hidden');
        } catch (e) {
            showError('Invalid JSON format: ' + e.message);
        }
    });

    clearBtn.addEventListener('click', () => {
        jsonInput.value = '';
        tableBody.innerHTML = '';
        hideError();
        resultView.classList.add('hidden');
        inputView.classList.remove('hidden');
    });

    function flattenObject(obj, prefix = '') {
        const flattened = {};

        for (const [key, value] of Object.entries(obj)) {
            const newKey = prefix ? `${prefix}.${key}` : key;

            if (value !== null && typeof value === 'object' && !Array.isArray(value)) {
                Object.assign(flattened, flattenObject(value, newKey));
            } else {
                flattened[newKey] = {value, type: newKey.includes('visualizations') ? 'visualisation' : 'string'};
            }
        }

        return flattened;
    }

    function displayTable(obj) {
        tableBody.innerHTML = '';
        const flattened = flattenObject(obj);

        for (const [key, value] of Object.entries(flattened)) {
            const row = document.createElement('tr');
            row.className = 'border-b border-slate-100 hover:bg-slate-50 transition-colors';

            const keyCell = document.createElement('td');
            keyCell.className = 'p-3 font-medium text-slate-900 font-mono text-sm';
            keyCell.textContent = key;

            const valueCell = document.createElement('td');
            valueCell.className = 'p-3 text-slate-700 text-center';
            if (value.type === 'string') {
                valueCell.textContent = formatValue(value.value);
            } else {
                const iframe = document.createElement('iframe');
                iframe.style.height = '400px';
                iframe.style.width = '100%';
                iframe.style.border = 'none';
                iframe.title = 'Visualisation'
                valueCell.appendChild(iframe);
                const button = document.createElement('button');
                button.textContent = 'Maximize';
                button.className = 'mt-4 px-6 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 transition-colors';
                button.addEventListener('click', () => {
                    document.getElementById('resultView').classList.remove('block');
                    document.getElementById('resultView').classList.add('hidden');
                    const maximizeIframe = document.createElement('iframe');
                    maximizeIframe.style.height = '100%';
                    maximizeIframe.style.width = '100%';
                    maximizeIframe.style.border = 'none';
                    maximizeIframe.title = 'Visualisation';
                    setTimeout(() => {
                        maximizeIframe.contentDocument.open();
                        maximizeIframe.contentDocument.write(value.value);
                        maximizeIframe.contentDocument.close();
                    }, 0)
                    const iframeContainer = document.createElement('div');
                    iframeContainer.className = 'absolute top-0 left-0 flex flex-col h-full w-full bg-white';

                    const maximizationHeader = document.createElement('div');
                    maximizationHeader.className = 'flex justify-end p-4 h-fit w-full';


                    const closeButton = document.createElement('button');
                    closeButton.className = "px-4 py-2 border border-slate-300 text-slate-700 rounded-md hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-slate-900 focus:ring-offset-2 transition-colors";
                    closeButton.textContent = 'Close';
                    closeButton.addEventListener('click', () => {
                        document.getElementById('resultView').classList.remove('hidden');
                        document.getElementById('resultView').classList.add('block');
                        document.body.removeChild(iframeContainer);

                    })
                    maximizationHeader.appendChild(closeButton);
                    iframeContainer.appendChild(maximizationHeader);
                    iframeContainer.appendChild(maximizeIframe);
                    document.body.appendChild(iframeContainer);
                })
                valueCell.appendChild(button);

                setTimeout(() => {
                    iframe.contentDocument.open();
                    iframe.contentDocument.write(value.value);
                    iframe.contentDocument.close();
                }, 0)
            }

            row.appendChild(keyCell);
            row.appendChild(valueCell);
            tableBody.appendChild(row);
        }
    }

    function formatValue(value) {
        if (value === null) return 'null';
        if (value === undefined) return 'undefined';
        if (value === '') return '(empty string)';
        if (Array.isArray(value)) return JSON.stringify(value);
        if (typeof value === 'object') return JSON.stringify(value);
        return String(value);
    }

    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.remove('hidden');
    }

    function hideError() {
        errorMessage.classList.add('hidden');
        errorMessage.textContent = '';
    }
</script>
</body>
</html>
